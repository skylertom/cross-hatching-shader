<html>

<head>
<title>Cross Hatching Shader</title>
<head>

<script id="shader-fs" type="x-shader/x-fragment">
    precision mediump float;
    //this specifies the precision for webGL. In this case, medium.
    //Options: lowp, mediump, highp.

    uniform sampler2D uSampler;
    uniform vec4 light_vector;
    uniform vec3 color;

    varying vec3 normal;
    uniform vec2 canvasSize;
    varying vec4 worldPos;
    varying vec3 mmin, mmax;

    void main(void) {
        vec3 finalcolor = vec3(1.0, 1.0, 1.0);
        float bump = max(0.0, dot(light_vector.xyz, normal));

    	if (color.r > 0.0) {
            finalcolor = color;
        }
        else {
            if((worldPos.x > mmin.x && worldPos.x < mmax.x) && (worldPos.y > mmin.y && worldPos.y < mmax.y)){
                vec2 coords = worldPos.xy - mmin.xy;
                finalcolor = texture2D(uSampler, coords.st).rgb;
            }
            finalcolor = finalcolor * bump;
        }
    	gl_FragColor = vec4(finalcolor, 1.0);
    }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    float PI = 3.1415926535897932384626433832795;

    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform vec2 mouseLocation;

    varying vec3 normal;

    varying vec3 mmin, mmax;
    varying vec4 worldPos;

    void main(void) {
    	normal = aVertexNormal;
    	gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        worldPos = gl_Position;
        vec3 m = vec3(mouseLocation, 1.0);
        mmax = m + .5;
        mmin = m - .5;
    }
</script>

<script type="text/javascript" src="gl-matrix-min.js"></script>
<script type="text/javascript" src="parse.js"></script>
<script type="text/javascript" src="start.js"></script>

<body onload="webGLStart();">
    <canvas id="myCanvas" style="border: none;" width="500" height="500"></canvas>
</body>
</html>
